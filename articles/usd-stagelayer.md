---
title: "Pythonã§å§‹ã‚ã‚‹USDã®åŸºæœ¬ - Stage/Layer"
emoji: "ğŸ˜¸"
type: "tech"
topics: ["USD","Python","3DCG"]
published: true
---
## ã¯ã˜ã‚ã«
ã•ã¦ã€‚
Maya2022ã‹ã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§USDã®ExportãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
ãã®ãŸã‚ã€æœ¬æ ¼çš„ã«USDã®æ¤œè¨¼ã‚’å§‹ã‚ã¦ã„ã‚‹äººã‚‚å¤šã„ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚

ãã†ã—ã¦USDã‚’è§¦ã‚Šå§‹ã‚ã‚‹ã¨ã€ä»Šã¾ã§ã«ãªã„USDç‰¹æœ‰ã®æ¦‚å¿µã§
ã‚ã‹ã‚Šã«ãã„ã€ã©ã†ã„ã†ã“ã¨ã‹ã‚ã‹ã‚‰ãªã„ã€ã€ã€ã¨ã„ã†ã“ã¨ãŒå‡ºã¦ãã‚‹ã®ã§ã¯ãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚
ãã‚“ãªä¸­ã‹ã‚‰ä»Šå›ã¯ã€
https://fereria.github.io/reincarnation_tech/11_Pipeline/01_USD/04_layer_stage/
ãŠãã‚‰ãå¤šãã®äººãŒæœ€åˆæ··ä¹±ã™ã‚‹ã§ã‚ã‚ã†USDã®åŸºæœ¬ **ã‚¹ãƒ†ãƒ¼ã‚¸/ãƒ¬ã‚¤ãƒ¤ãƒ¼** ã‚’
Pythonã‚’åˆ©ç”¨ã—ã¤ã¤è©³ã—ãè§£èª¬ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

## ãƒ¬ã‚¤ãƒ¤ãƒ¼

ã¾ãšã¯ã€ã‚µãƒ³ãƒ—ãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦ã¿ã¾ã™ã€‚




```python
import os
from pxr import Usd,Sdf

USD_ROOT = os.getcwd() + "/usd"
layer = Sdf.Layer.FindOrOpen(f"{USD_ROOT}/cube.usda")
print(layer)
print(layer.ExportToString())
```

```bat : >> Result
Sdf.Find('d:/work/zenn_ipynb/ipynb/usd/cube.usda')
#usda 1.0
(
    defaultPrim = "cube"
)

def Cube "cube"
{
    int testValue = 10
}



```

ã¾ãšï¼‘ã¤ã‚ãŒã€ãªã‚“ã®ã‚³ãƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚‚å«ã¾ãªã„ã€ã‚·ãƒ³ãƒ—ãƒ«ãªã‚­ãƒ¥ãƒ¼ãƒ–ã«ã€  
testValueã¨ã„ã†ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã«10ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã™ã€‚  
  
ã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é–‹ãã«ã¯ã€Sdf.Layer.FindOrOpen ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚  
FindOrOpenã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚  
ã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰ ExportToString() ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«  
è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ã‚·ãƒ¼ãƒ³ã‚°ãƒ©ãƒ•ã‚’ã€ã‚¢ã‚¹ã‚­ãƒ¼ã§è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚




```python
refLayer = Sdf.Layer.FindOrOpen(f"{USD_ROOT}/reference.usda")
print(refLayer.ExportToString())
```

```bat : >> Result
#usda 1.0
(
    defaultPrim = "root"
)

def Xform "root"
{
    def "CubeA" (
        prepend references = @cube.usda@
    )
    {
        int testValue = 100
    }

    def "CubeB" (
        prepend references = @cube.usda@
    )
    {
    }
}



```

æ¬¡ã«ã€ã‚‚ã†ä¸€ã¤ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é–‹ã„ã¦ã¿ã¾ã™ã€‚  
  
ã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã¯ã€ã€Œãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã€ã®ã‚³ãƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³ãŒå«ã¾ã‚Œã¦ã„ã¦ã€  
![](https://gyazo.com/5b1e6a112f161fcde70768434e1ddf9a.png)    
ãã—ã¦ã€CubeAã«ã¯ã€ŒtestValueã€ã¨ã„ã†ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã«100ã¨ã„ã†å€¤ãŒã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹  
äº‹ãŒã‚ã‹ã‚Šã¾ã™ã€‚

ã§ã™ãŒã€ã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã ã‘ã§ã¯  
**ã€Œã‚ãã¾ã§ã‚‚ç¾åœ¨é–‹ã„ã¦ã„ã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¨˜è¿°ã®ã¿ã€**ãŒã‚ã‹ã‚‹ã ã‘ã§  
ã€Œã“ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã•ã‚Œã¦ã„ã‚‹åˆ¥ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨åˆæˆã—ãŸçµæœã©ã®ã‚ˆã†ãªã‚·ãƒ¼ãƒ³ã‚°ãƒ©ãƒ•ãŒå‡ºæ¥ä¸ŠãŒã‚‹ã‹ã€ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚

ã“ã®ã‚ˆã†ã«ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã¯ã€Œæœ€çµ‚çš„ã«åˆæˆã•ã‚Œã‚‹ã‚·ãƒ¼ãƒ³ã‚°ãƒ©ãƒ•ã®å…ƒã«ãªã‚‹ã‚‚ã®ã€ã®ã“ã¨ã§ã™ã€‚

## ã‚¹ãƒ†ãƒ¼ã‚¸
  
ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’é–‹ã„ãŸã ã‘ã§ã¯ã€ã‚ãã¾ã§ã‚‚ãã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«è¨˜è¿°ã•ã‚ŒãŸæƒ…å ±ã®ã¿ãŒ  
è¡¨ç¤ºã•ã‚Œã‚‹ã ã‘ã§ã€æœ€çµ‚çš„ã«åˆæˆã•ã‚ŒãŸã‚·ãƒ¼ãƒ³ã‚°ãƒ©ãƒ•ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚  
ã§ã¯ã€ãã®è¤‡æ•°ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰åˆæˆã•ã‚ŒãŸã€Œæœ€çµ‚çš„ãªçµæœã€ãŒãªã«ã‹ã¨ã„ã†ã¨  
ãã‚ŒãŒã€Œã‚¹ãƒ†ãƒ¼ã‚¸ã€ã¨å‘¼ã°ã‚Œã‚‹ã‚‚ã®ã§ã™ã€‚




```python
stage = Usd.Stage.Open(refLayer)
print(stage.ExportToString())
```

```bat : >> Result
#usda 1.0
(
    defaultPrim = "root"
    doc = """Generated from Composed Stage of root layer d:\\work\\zenn_ipynb\\ipynb\\usd\\reference.usda
"""
)

def Xform "root"
{
    def Cube "CubeA"
    {
        int testValue = 100
    }

    def Cube "CubeB"
    {
        int testValue = 10
    }
}



```

å…ˆç¨‹ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã€ã‚¹ãƒ†ãƒ¼ã‚¸ã§é–‹ã„ã¦ã¿ã¾ã™ã€‚  
é–‹ã„ã¦ã„ã‚‹ã®ã¯ reference.usda ã§ã€

![](https://gyazo.com/081754363bef018a7e576919358882e4.png)  

ã“ã®ã‚ˆã†ãªæ§‹é€ ã«ãªã£ã¦ã„ã¾ã™ã€‚
ã“ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã®çµæœã‚’ã€åŒã˜ã ExportToString() ã—ã¦ã¿ã‚‹ã¨ã©ã†ãªã‚‹ã‹ã¨ã„ã†ã¨

![](https://gyazo.com/4dfa81e881286cd97f48999efd461c57.png)

çµæœã¯ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚  
å…ˆã»ã©ã¨ã¯é•ã„ã€Stage.Openã§é–‹ã„ãŸãƒ¬ã‚¤ãƒ¤ãƒ¼ä»¥ä¸‹ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«æ›¸ã‹ã‚ŒãŸæƒ…å ±(testValueã®å€¤ã‚„ã€Primã‚¿ã‚¤ãƒ—)  
ãŒã€å…¨ã¦åˆæˆã•ã‚ŒãŸçŠ¶æ…‹ã«ãªã£ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚  
  
ã¤ã¾ã‚Šã€ã“ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã¨ã„ã†ã®ã¯  
ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆã“ã®å ´åˆã¯ reference.usdaï¼‰ã¨ã€ã“ã®ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ãƒ¤ãƒ¼ä»¥ä¸‹ã«ã‚ã‚‹ã‚³ãƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚’  
**åˆæˆã—ãŸçµæœã§ãã‚ãŒã£ãŸçµæœ**ã®ã“ã¨ã‚’æŒ‡ã—ã¦ã„ã¾ã™ã€‚  

ãã®ãŸã‚ã€USDã§åˆæˆã•ã‚ŒãŸçµæœã®ã‚·ãƒ¼ãƒ³ã‚°ãƒ©ãƒ•ã‚’æ“ä½œã—ãŸã„å ´åˆã¯Usd.Stageã‚’ä½¿ç”¨ã™ã‚‹ã—ã€  
ãã®ã‚¹ãƒ†ãƒ¼ã‚¸å†…ã®ã‚ã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆusdãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã®æƒ…å ±ã‚’å–å¾—ã—ãŸã„å ´åˆã¯  
Sdf.Layer ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚Œã°ã€ç›®çš„ã®æƒ…å ±ã«ãŸã©ã‚Šç€ãã“ã¨ãŒã§ãã¾ã™ã€‚  

## ãƒ—ãƒªãƒ ã¨ãƒ—ãƒªãƒ ã‚¹ãƒšãƒƒã‚¯

ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã‚¹ãƒ†ãƒ¼ã‚¸ã®é–¢ä¿‚ã«ã¤ã„ã¦ãªã‚“ã¨ãªãåˆ†ã‹ã£ã¦ããŸã¨ã“ã‚ã§  
ãƒ—ãƒªãƒ ã¨ãƒ—ãƒªãƒ ã‚¹ãƒšãƒƒã‚¯ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚  
  
ã¾ãšã€ãƒ—ãƒªãƒ ã¨ã„ã†ã®ã¯ãªã«ã‹ã¨ã„ã†ã¨Mayaã§ã„ã†ã¨ã“ã‚ã®Nodeã«ã‚ãŸã‚‹ã‚‚ã®ã§ã™ã€‚  
ä¸Šã®ä¾‹ãªã‚‰ã°ã€rootã‚„CubeAãªã©ãŒãƒ—ãƒªãƒ ã«ã‚ãŸã‚Šã¾ã™ã€‚  




```python
primA = stage.GetPrimAtPath('/root/CubeA')
print(primA)
```

```bat : >> Result
Usd.Prim(</root/CubeA>)

```

ã‚¹ãƒ†ãƒ¼ã‚¸ã‹ã‚‰GetPrimAtPathã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€æŒ‡å®šã—ãŸãƒ‘ã‚¹ã®ãƒ—ãƒªãƒ ã‚’  
å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚  
  
ç¹°ã‚Šè¿”ã—ã«ãªã‚Šã¾ã™ãŒã€  
ã€Œã‚¹ãƒ†ãƒ¼ã‚¸ã€ã¨ã¯ã€Œè¤‡æ•°ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®åˆæˆã—ãŸçµæœå‡ºæ¥ä¸ŠãŒã£ãŸã‚·ãƒ¼ãƒ³ã‚°ãƒ©ãƒ•ã€ã§ã™ã€‚  
ã¤ã¾ã‚Šã€ã‚¹ãƒ†ãƒ¼ã‚¸ä¸Šã«ã‚ã‚‹ãƒ—ãƒªãƒ ã‚’ GetPrimAtPathã§å–å¾—ã—ãŸå ´åˆã«  
å–å¾—ã§ãã‚‹ã‚‚ã®ã¯ã€Œãƒ—ãƒªãƒ ã€ã§ã‚ã‚Šã€  
**ã„ãã¤ã‹ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚ˆã£ã¦åˆæˆã•ã‚ŒãŸçµæœã§ãã‚ãŒã£ãŸã‚‚ã®** ã«ãªã‚Šã¾ã™ã€‚  

## ã‚¹ãƒšãƒƒã‚¯

ãŸã¨ãˆã°CubeAã‚’ä¾‹ã«ä¸Šã’ã‚‹ã¨ã€  
reference.usda ã® CubeA ã¨ cube.usda ã® cube ã¨ã„ã†2ã¤ãŒåˆæˆã•ã‚ŒãŸçµæœ  
CubeAãŒå‡ºæ¥ä¸ŠãŒã£ã¦ã„ã¾ã™ã€‚  

ã“ã®CubeAã¨ã„ã†ãƒ—ãƒªãƒ ãŒã©ã®ã‚ˆã†ã«æ§‹æˆã•ã‚Œã¦ã„ã‚‹ã‹ã‚’åˆ†è§£ã—ã¦ã¿ã‚‹ã¨ã€

![](https://gyazo.com/e5af205028ffac2596622035d2b784e6.png)

ã“ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

ãã‚Œãã‚Œã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã€ã‚·ãƒ¼ãƒ³ã‚°ãƒ©ãƒ•ã«çµ„ã¿ç«‹ã¦ã‚‰ã‚Œã‚‹å‰ã® 
reference.usda ã® CubeA ã‚„ã€ cube.usda ã® cubeãªã©ã®è¦ç´ ã‚’PrimSpecã¨å‘¼ã³ã¾ã™ã€‚
ã“ã‚Œã¯ã€åˆæˆã•ã‚Œã‚‹å‰ã®ã€Œä¸»å¼µï¼ã‚ªãƒ”ãƒ‹ã‚ªãƒ³ã€ã§ã™ã€‚

ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰ã€Primã‚’å–å¾—ã—ã¦ãã®Primã®Attributeã‚’å–å¾—ã—ãŸä¾‹ã§ã™ã€‚




```python
for attr in primA.GetAttributes():
    print(attr)
```

```bat : >> Result
Usd.Prim(</root/CubeA>).GetAttribute('doubleSided')
Usd.Prim(</root/CubeA>).GetAttribute('extent')
Usd.Prim(</root/CubeA>).GetAttribute('orientation')
Usd.Prim(</root/CubeA>).GetAttribute('primvars:displayColor')
Usd.Prim(</root/CubeA>).GetAttribute('primvars:displayOpacity')
Usd.Prim(</root/CubeA>).GetAttribute('purpose')
Usd.Prim(</root/CubeA>).GetAttribute('size')
Usd.Prim(</root/CubeA>).GetAttribute('testValue')
Usd.Prim(</root/CubeA>).GetAttribute('visibility')
Usd.Prim(</root/CubeA>).GetAttribute('xformOpOrder')

```

å¯¾ã—ã¦Primã‹ã‚‰å–å¾—ã—ãŸå ´åˆã¯ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

![](https://gyazo.com/3d29ea4284f03aad537d9333e5b9253a.png)

Primã‹ã‚‰å–å¾—ã—ãŸå ´åˆã€ã‚³ãƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³ã—ãŸçµæœã‹ã‚‰ç”Ÿã¾ã‚Œã‚‹ã‚‚ã®ãªã®ã§  
ã™ã¹ã¦ã®Attributeã‚’å–å¾—ã—ãŸå ´åˆã€UsdGeomCubeã‚¹ã‚­ãƒ¼ãƒã®ã®ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã¨  
reference.usda ã«è¨˜è¿°ã•ã‚ŒãŸã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã®åˆæˆã—ãŸçµæœã®Attributeã®ãƒªã‚¹ãƒˆãŒå–å¾—ã§ãã¾ã™ã€‚  




```python
spec = refLayer.GetPrimAtPath('/root/CubeA')
for attr in spec.attributes:
    # ã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹Attributeã®ã¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹
    print(attr)
```

```bat : >> Result
Sdf.Find('d:/work/zenn_ipynb/ipynb/usd/reference.usda', '/root/CubeA.testValue')

```

å¯¾ã—ã¦ã€ãƒ—ãƒªãƒ ã‚¹ãƒšãƒƒã‚¯ã‹ã‚‰ã‚¢ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ãƒˆã‚’å–å¾—ã—ãŸå ´åˆã¯ã©ã†ãªã‚‹ã‹ã¨ã„ã†ã¨  

![](https://gyazo.com/1d2309444757ac7a1c92f31260731e67.png)

ã‚ãã¾ã§ã‚‚ã“ã® **ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«è¨˜è¿°ã•ã‚ŒãŸã€Œæ„è¦‹ï¼ˆã‚ªãƒ”ãƒ‹ã‚ªãƒ³ï¼‰ã€** ã®ã¿ãŒãƒªã‚¹ãƒˆã•ã‚Œã‚‹ã®ã§ã€çµæœã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ 

## ã¾ã¨ã‚

ã“ã“ã¾ã§å‡ºãŸç”¨èªã‚’ã¾ã¨ã‚ã¦ã¿ã¾ã™ã€‚  

ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯USDãƒ•ã‚¡ã‚¤ãƒ«ã®ã“ã¨ã§ã€ã‚·ãƒ¼ãƒ³ã‚°ãƒ©ãƒ•ã‚’æ§‹ç¯‰ã™ã‚‹ã¨ãã® **ã€Œå…ƒæƒ…å ±ã€** ã§ã™ã€‚  
ãƒ¬ã‚¤ãƒ¤ãƒ¼å˜ä½“ã§ã¯æœ€çµ‚çš„ãªã‚·ãƒ¼ãƒ³ã‚°ãƒ©ãƒ•ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚  

ã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ã‚³ãƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³ã—ã¦çµ„ã¿ç«‹ã¦ã‚‰ã‚ŒãŸçµæœã§ããŸã‚‚ã®ã‚’ **ã€Œã‚¹ãƒ†ãƒ¼ã‚¸ã€** ã¨å‘¼ã³ã¾ã™ã€‚

å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã”ã¨ã«æ›¸ã‹ã‚ŒãŸ ã€Œã“ã®ãƒ—ãƒªãƒ ã¯ã“ã†ã‚ã£ã¦ã»ã—ã„ã€ã¨ã„ã† Primã®å…ƒã«ãªã‚‹Prim ã‚’ **ãƒ—ãƒªãƒ ã‚¹ãƒšãƒƒã‚¯** ã¨å‘¼ã³ã¾ã™ã€‚  
ãã—ã¦ã€ãã®ãƒ—ãƒªãƒ ã‚¹ãƒšãƒƒã‚¯ã«æ›¸ã‹ã‚ŒãŸæƒ…å ±ã®ã“ã¨ã‚’ **ã‚ªãƒ”ãƒ‹ã‚ªãƒ³ï¼ˆï¼æ„è¦‹ï¼‰** ã¨å‘¼ã³ã¾ã™ã€‚  
  
ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰ã ã¨ãªã«ãŒå–å¾—ã§ãã¦ã€ã‚¹ãƒ†ãƒ¼ã‚¸ã‹ã‚‰ã ã¨ä½•ãŒå–å¾—ã§ãã‚‹ã®ã‹  
ã¨ã„ã†ã®ã¯ã€USDã‚’èª¿ã¹ãŸç›´å¾Œã¯ã‚ã‹ã‚Šã«ãã„ã§ã™ãŒ  
ã“ã®é•ã„ã‚’ç†è§£ã™ã‚‹ã“ã¨ã§ã€USDã‚’Pythonã‚„SOLARISã®ãªã©ã§æ‰±ã†å ´åˆã®ç†è§£ã—ã‚„ã™ããªã‚‹ã®ã§ã¯ãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚  

## Primã‹ã‚‰PrimSpecã‚’å–å¾—ã™ã‚‹ï¼ˆãŠã¾ã‘ï¼‰

æœ€å¾Œã«å¿œç”¨ç·¨ã€‚  
Primã¨PrimSpecã€ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ç†è§£ã—ãŸã¨ã“ã‚ã§  
Primã‹ã‚‰ãã®Primã‚’æ§‹æˆã™ã‚‹ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚„Specã‚’å–å¾—ã—ã¦ã¿ã¾ã™ã€‚  




```python
query =Usd.PrimCompositionQuery(primA)

# Compositionã‚’å–å¾—ã™ã‚‹
for comp in query.GetCompositionArcs():
    print(comp.GetArcType())
    node = comp.GetTargetNode()
    # Target=ã•ã‚Œã¦ã„ã‚‹Nodeã€Introducing=ã—ã¦ã„ã‚‹Nodeã‚’å–å¾—ã§ãã‚‹
    # NodeRefã¨ã¯ã€ã‚·ãƒ¼ãƒ³ãƒ‡ã‚£ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚’åˆæˆã™ã‚‹ãŸã‚ã®ãƒãƒ¼ãƒ‰ï¼ˆã‚³ãƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³ï¼‰ã‚’å–å¾—ã§ãã‚‹
    if node.IsRootNode():
        # RootNodeã®å ´åˆã€LayerStackã®å…ˆé ­ã«ã‚¢ãƒãƒ‹ãƒã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒå«ã¾ã‚Œã‚‹ã®ã§
        # 2ç•ªç›®ã‚’RootLayerã¨ã—ã¦å–å¾—ã™ã‚‹ã€‚
        layer = node.layerStack.layers[1]
    else:
        layer = node.layerStack.layers[0]
    primSpec = layer.GetPrimAtPath(node.path)
    print(primSpec)
    # AttributeSpec
    for i in primSpec.attributes:
        print(i)
```

```bat : >> Result
Pcp.ArcTypeRoot
Sdf.Find('d:/work/zenn_ipynb/ipynb/usd/reference.usda', '/root/CubeA')
Sdf.Find('d:/work/zenn_ipynb/ipynb/usd/reference.usda', '/root/CubeA.testValue')
Pcp.ArcTypeReference
Sdf.Find('d:/work/zenn_ipynb/ipynb/usd/cube.usda', '/cube')
Sdf.Find('d:/work/zenn_ipynb/ipynb/usd/cube.usda', '/cube.testValue')

```

å–å¾—ã™ã‚‹ã«ã¯ PrimCompositionQueryã‚’ä½¿ç”¨ã—ã¾ã™ã€‚  
ã“ã‚Œã¯ã€é–¢æ•°åã®ã¨ãŠã‚Šã€Œã‚ã‚‹Primã®ã‚³ãƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚’ã™ã¹ã¦åˆ—æŒ™ã€ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚  
ã‚³ãƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³é–¢ä¿‚ã¯PCPã¨ã„ã†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹ã®ã§ã™ãŒã€  
ãã®ã‚ãŸã‚Šã¯è©³ç´°ã¯ [PCPã§ã‚³ãƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚¢ãƒ¼ã‚¯ã®æ§‹é€ ã‚’è§£æãƒ»ç·¨é›†å¯¾è±¡ã‚’å–å¾—ã™ã‚‹](https://fereria.github.io/reincarnation_tech/11_Pipeline/30_USD_Programming/01_Python/04_pcp_compositionArc/)ã§  
è©³ã—ãæ›¸ã„ã¦ã‚ã‚Šã¾ã™ã®ã§ãã¡ã‚‰ã‚’å‚ç…§ã€‚
